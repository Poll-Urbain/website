<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="css/style.css" />

    <link rel="manifest" href="/manifest.json" />
    <!-- ios support -->
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_72x72.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_96x96.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_128x128.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_144x144.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_152x152.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_192x192.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_384x384.png" />
    <link rel="apple-touch-icon" href="images/icons/poll_urbain_logo_512x512.png" />
    <meta name="apple-mobile-web-app-status-bar" content="#db4938" />
    <meta name="theme-color" content="#db4938" />

    <title>Interactive Map</title>
</head>

<body>
    <main>
        <!--resize the next div-->
        <div id="map-container">
            <h1>Poll Urbain</h1>
            <div id="map"></div>
            <div id="spot-info"></div>
            <input type="text" id="address-input" placeholder="Enter address">
            <button onclick="geocodeAddress()">Show Coordinates</button>
        </div>
        <div id="camera-button">
            <!--button to add camera-->
            <label for="file-input">
                <img id="camera-pic" src="images/pics/camera-icon.png" />
            </label>
            <input id="file-input" type="file" name="image" accept="image/*" capture="environment"
                onsubmit="previewFile()">
            <img id="preview" src="" height="200" alt="Image preview...">
        </div>
    </main>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", function () {
                navigator.serviceWorker
                    .register("/serviceWorker.js")
                    .then(res => console.log("service worker registered"))
                    .catch(err => console.log("service worker not registered", err))
            })
        }

        const isMobile = navigator.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i);


        // include script position.js
        var script = document.createElement('script');
        script.src = 'js/position.js';
        document.head.appendChild(script);
        if (isMobile) {
            document.getElementById('map').style.height = "60vh";
        }
        else {
            // If not mobile, hide the camera button
            document.getElementById('camera-button').style.display = 'none';
            document.getElementById('map').style.height = "80vh";
        }
    </script>
    <script>
        var map = L.map('map').setView([49.183333, -0.350], 13); // Updated coordinates

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Example spot with updated coordinates, larger popup, a button, and a dropdown list
        var ledomeVegetal = L.marker([49.18171143760297, -0.34688136578783596]).addTo(map);
        ledomeVegetal.bindPopup(
            "<div class='popup-content'>" +
            "<b>Le Dôme Végétalisé</b><br>" +
            "Caractéristiques (proba): A, B, C<br>" +
            '<img src="images/ledome_vegetal.png" alt="Le Dôme Végétal Image" style="width:100%; height:auto;">' +
            '<br><button onclick="onButtonClick()">Voter pour</button>' +
            '<br><label for="dropdown">Choose an option:</label>' +
            '<select id="dropdown">' +
            '<option value="option1">Chaleur</option>' +
            '<option value="option2">Inondation</option>' +
            '<option value="option3">Air</option>' +
            '</select>' +
            "</div>"
        );

        // Function to handle button click
        function onButtonClick() {
            var dropdownValue = document.getElementById('dropdown').value;
            alert("Button clicked! Dropdown selected value: " + dropdownValue);
        }

        // Function to geocode the entered address and display coordinates
        function geocodeAddress() {
            var addressInput = document.getElementById('address-input').value;

            // Replace 'YOUR_OPENCAGE_API_KEY' with your actual OpenCage API key
            var apiKey = 'a5d1c0cbcabb4a1a8f506c8415d80cb3';
            var geocodeUrl = 'https://api.opencagedata.com/geocode/v1/json?q=' + encodeURIComponent(addressInput) + '&key=' + apiKey;

            fetch(geocodeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data.results.length > 0) {
                        var coordinates = data.results[0].geometry;
                        var coordinatesText = "Coordinates for '" + addressInput + "': " +
                            "Latitude: " + coordinates.lat.toFixed(6) +
                            ", Longitude: " + coordinates.lng.toFixed(6);

                        // Display coordinates in the side panel
                        document.getElementById('spot-info').innerHTML = "<div class='popup-content'>" + coordinatesText + "</div>";
                    } else {
                        alert("Geocoding failed. Please enter a valid address.");
                    }
                })
                .catch(error => {
                    console.error('Error during geocoding:', error);
                    alert("An error occurred during geocoding. Please try again.");
                });
        }

        // Example side panel
        var spotInfo = document.getElementById('spot-info');

        map.on('click', function (e) {
            var clickedLatLng = e.latlng;
            var clickedCoordinates = "Latitude: " + clickedLatLng.lat.toFixed(6) + "<br>Longitude: " + clickedLatLng.lng.toFixed(6);

            // Display clicked coordinates in the side panel
            spotInfo.innerHTML = "<div class='popup-content'><b>Clicked Point</b><br>" + clickedCoordinates + "</div>";
        });
    </script>

</body>

</html>